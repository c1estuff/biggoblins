// Add this at the top of your script.js file
const membersText = `07scapiing,Artillery,1-Nov-2021
0P3thek1d,Archer,9-Aug-2022
159th,Artillery,28-Dec-2021
1mMuff1Man,Archer,11-Apr-2022
2GayIronMen,Archer,10-Jan-2024
5hanks,Battlemage,13-Jan-2023
7z ya 7z,Archer,3-Jan-2022
89 Pk1,Artillery,29-Dec-2021
91casthogox,Infantry,26-May-2021
9p7,Archer,16-Dec-2022
9pb,Deputy Owner,26-Nov-2023
[#M2O7VH7IK],Archer,3-Jan-2023
Abdul Melik,Battlemage,8-Nov-2021
Abo Mohamed,Archer,11-Jul-2022
Addicted2Me,Artillery,5-Nov-2021
aDuckOnQuak,Battlemage,27-Nov-2021
AegisArtemis,Deputy Owner,1-Nov-2021
AegisIron,Gamer,23-Jul-2024
AFC020,Archer,8-Jul-2022
Agent 25,Archer,12-Jun-2022
Ak47MyDick,Crusader,22-Feb-2023
Alinaq,Battlemage,6-Nov-2021
AlsoRipple,Archer,23-Apr-2023
Angel Arm,Sniper,25-Apr-2022
AnkhAngel,Battlemage,7-Mar-2022
Applejuic3e,Battlemage,20-Apr-2022
ArchAngel007,Sapphire,5-Nov-2021
Asgaror22,Saviour,4-Aug-2022
AssFart,Archer,11-Apr-2022
Atlas Pierce,Archer,24-Apr-2022
aviorisback,Archer,5-Jan-2023
Ayo John,Battlemage,29-Dec-2021
A Bicep Bear,Battlemage,24-Sep-2023
a good clan,Battlemage,15-Dec-2021
b00mnochance,Battlemage,1-Dec-2021
Babayaga-9,Crusader,10-May-2022
BadgerRed,Archer,16-Dec-2022
Big 0l bitys,Archer,1-Jul-2021
Billy Trunks,Archer,24-May-2024
Bobbalicious,Archer,29-Dec-2021
boneshatters,Archer,28-Nov-2022
BoogeeBandit,Elite,14-Feb-2022
boost leak,Archer,4-Nov-2021
BOWIEBOSS,Archer,31-May-2021
BrotherSwift,Archer,18-May-2022
bro ask wiki,Moderator,29-Dec-2021
BucketBilly,Looter,24-Feb-2023
B uk,Archer,31-May-2021
c1e,Owner,26-May-2021
CandyKleosis,Artillery,22-Oct-2022
CaptDBlue,Archer,11-Apr-2022
CasinoCoin,Archer,7-Oct-2023
Cawsin24,Archer,23-Feb-2022
Cclayton,Raider,13-Nov-2021
Chance Clay,Archer,8-Jun-2023
choadybrody,Administrator,4-Jul-2022
Churchill144,Battlemage,28-Dec-2022
City of Um,Hellcat,29-Sep-2023
Clapp3r,Goblin,6-Dec-2024
Comekkake,Deputy Owner,2-Mar-2024
D0RAEXPL0RER,Archer,31-Oct-2021
D1LDORUNN3R,Saviour,25-Jul-2023
Dabba Doo Ya,Archer,8-Jul-2022
DabDabDan,Looter,20-Oct-2022
Dark Cored,Archer,11-Apr-2022
Dark Times,Archer,12-Apr-2023
darunne94,Archer,11-Jan-2022
DeadReaperpr,Archer,1-Nov-2021
DeathUGCMD,Archer,17-Feb-2024
Dedlyft,Archer,1-Dec-2021
DeeJayBrewJr,Artillery,19-Jun-2022
Delyrias,Archer,3-Nov-2021
derek1574,Archer,30-Dec-2021
DickOfStone,Elite,26-May-2021
DilfDolphin,Archer,12-Jan-2022
Diokrates,Battlemage,12-Apr-2022
Dioswagg,Archer,3-Nov-2021
Diq piw,Archer,9-Jun-2022
DJBrewski,Battlemage,1-Jul-2023
Dracelmaster,Archer,28-Dec-2021
DrFuji69,Goblin,20-Nov-2024
DrMantisT,Artillery,12-Feb-2023
drsociopath,Archer,24-May-2022
duckgirl666,Archer,2-Nov-2021
Dustymuffs,Archer,28-Jun-2022
Dutchmal,Archer,20-Feb-2022
Dylrune,Archer,21-May-2022
Dzap,Archer,9-Jul-2023
eaglevice,Archer,27-May-2021
EAT 1 ATTACK,Archer,16-Jan-2023
Evils U,Archer,28-May-2022
e fishing c,Archer,28-Mar-2023
FAMoh,Archer,3-Jul-2022
Fat CumWiz,Archer,3-May-2022
Faulty MH,Archer,23-Feb-2022
Fix me,Archer,2-Feb-2023
FLlCK DA BlC,Archer,19-Aug-2023
Food stamp5,Archer,1-Nov-2021
ForTheMidget,Archer,10-May-2023
frankyplasm,Goblin,15-Nov-2024
fupa smegma,Infantry,3-Apr-2023
G59 NICK,Goblin,27-Dec-2024
Galhardo I,Archer,26-May-2021
Gapenator,Sniper,1-Mar-2024
Garre tt,Archer,27-Nov-2021
GayIronMen2,Archer,10-Jan-2024
Get a Rune,Goblin,15-Nov-2024
Gevorgas,Archer,3-Nov-2021
gimosrsdream,Archer,16-Jan-2024
Gimpurp arro,Deputy Owner,16-Dec-2024
Gim Zewt,Battlemage,5-Jan-2024
Gingers Lmao,Ruby,6-Nov-2021
Ginsu67,Archer,31-May-2021
GlxyM8,Moderator,22-Feb-2022
God of Feelz,Battlemage,14-Dec-2021
Goonin4zaza,Saviour,30-Jul-2024
grabasstic,Gamer,8-Jan-2023
GrandOsmosis,Goblin,28-Mar-2024
Grimy Peen,Battlemage,20-Apr-2022
GuerillaDel,Goblin,16-Nov-2024
GwennyDeath,Archer,31-Dec-2021
HCIM GRAB,Archer,5-Aug-2022
HendricksMF,Archer,4-Mar-2022
Henry Hamcok,Archer,18-Mar-2023
HeyMilhouse,Archer,29-Dec-2021
High Up,Goblin,15-Nov-2024
Ho-LeeFook,Archer,23-Apr-2023
HolesOnVHS,Archer,19-Aug-2022
Ho Yaaaaaaa,Goblin,6-Dec-2024
Hungry Krog,Goblin,31-Aug-2024
I1amthe1I,Goblin,20-Nov-2024
Ihlfe,Goblin,11-Jan-2025
IloveNox,Battlemage,21-Oct-2022
IMPoaches,Battlemage,18-Feb-2024
Imretje,Archer,7-Jan-2024
Intense CQ,Goblin,15-Nov-2024
ip4yback,Archer,14-Feb-2022
ipvm4cash,Battlemage,23-Dec-2021
IronAbstract,Dragonstone,16-Apr-2023
IronGlxy,Moderator,28-Jan-2024
IronWaffable,Archer,4-Feb-2022
Irreligi0us,Archer,8-Jul-2023
I am Niels,Administrator,26-Jan-2022
I delay lumb,Archer,4-Dec-2023
I O U A B J,Battlemage,6-Nov-2021
J1bbs,Battlemage,1-Nov-2021
Jacovah,Archer,12-Jan-2022
Jacovah20,Archer,18-Nov-2022
Jarabo,Archer,20-Dec-2021
Jayblessed,Archer,27-Jun-2023
Jesus Bags,Archer,6-Jan-2022
Jeydeeess22,Archer,9-May-2023
John Thickk,Archer,4-Feb-2023
JorDankasaur,Archer,5-Jan-2023
JoWeDe,Goblin,14-Apr-2024
Jublek,Archer,23-Dec-2022
judith78,Archer,6-Aug-2022
Juliusx1pk,Archer,26-Dec-2021
J V D,Archer,7-Nov-2021
K040,Archer,3-Nov-2021
Kaexe,Archer,27-Jul-2023
kalibunghole,Archer,28-Dec-2021
karensue,Battlemage,11-Apr-2022
Keerynn,Archer,27-Nov-2021
Keeseque,Goblin,15-Nov-2024
King777,Maxed,17-Sep-2023
King 777,Maxed,17-Sep-2023
King  777,Maxed,13-Jul-2023
kleosis,Archer,22-Oct-2022
KnghtBushido,Archer,1-Jul-2021
kodakid98,Archer,22-Mar-2024
KODTHEGOD,Battlemage,30-May-2021
KongKing,Goblin,15-Nov-2024
legitcombos,Archer,28-May-2022
leutwiler 62,Archer,2-Nov-2021
Life Lyne,Archer,29-Apr-2022
LilPixelBoy,Archer,9-May-2024
lK A N Gl,Archer,12-Jul-2022
LoneWolf1593,Archer,4-Dec-2022
LordBotCheek,Archer,4-Jan-2024
Lord Toofus,Administrator,31-Jan-2022
Ludacrits,Archer,7-Aug-2022
l c e King,Archer,7-Nov-2021
Magi Licht,Administrator,28-May-2021
main hustle,Archer,23-Jul-2023
MaxGearGrind,Gamer,23-Jul-2024
Mayor Hobb,Archer,8-May-2022
Mcloviiinnn,Battlemage,11-Sep-2022
Miami 305,Archer,5-Jan-2023
midgetirons,Goblin,7-Apr-2024
Miichkov,Archer,7-Jun-2024
Moe L3ster97,Archer,10-Apr-2022
mojodigdug,Archer,18-Nov-2022
MOJO 76,Artillery,18-Jul-2023
MomPaysMyMem,Archer,5-Jan-2023
Money4128,Archer,7-Oct-2023
MootMania,Archer,15-Mar-2022
MrRodiego,Battlemage,10-Apr-2022
mr 72,Archer,20-May-2023
Mr Graahk,Archer,26-Nov-2021
Munax al,Archer,7-Jan-2024
Munthunter,Crusader,1-Jun-2024
NekoKokoro83,Raider,31-Jul-2023
Nerd-Scape,Archer,30-Jan-2023
NghtRaider,Moderator,8-Jul-2023
NiceCoxDude,Gamer,4-Nov-2021
NiceDickBabe,Deputy Owner,26-Nov-2024
nice bobbies,Archer,29-Dec-2021
NoLyfn,Archer,11-Apr-2022
NoSceptre,Goblin,22-Jun-2024
NotReturning,Archer,30-Jul-2024
NovaJess,Crusader,30-Jun-2022
nutziron,Battlemage,28-Jun-2023
Oak Snake 84,Archer,1-Jun-2021
Oceait,Archer,1-Nov-2021
OG Lue51,Crusader,1-Apr-2023
Olafwalk2097,Archer,2-Nov-2021
omwtfybiyb,Goblin,10-Sep-2024
OneMoistyBoi,Goblin,4-Dec-2024
PapaSteve,Archer,23-May-2024
Peaches Two,Archer,26-May-2021
pepnut,Archer,28-Mar-2023
PEPP3Rcorn,Deputy Owner,4-Nov-2021
PEPP3Rmints,Battlemage,4-Nov-2021
PEPP3Rnut,Deputy Owner,27-May-2021
pep pur,Archer,28-Mar-2023
pep purr,Deputy Owner,4-Nov-2021
Petmealittle,Battlemage,31-Oct-2021
Phinnnn87,Archer,7-Jul-2021
pizzacyle1,Battlemage,6-Feb-2022
pking dun ez,Archer,30-Nov-2022
PK Elizabeth,Archer,5-Nov-2021
Please Sniff,Archer,5-Jan-2023
Poootez,Battlemage,27-Nov-2023
Pootezalt,Goblin,21-May-2024
Pootezaltt,Goblin,23-May-2024
pupboi524,Goblin,14-Dec-2024
PureCumm,Archer,21-Jan-2023
purplearrowz,Crusader,4-Nov-2021
Purple Arr0w,Deputy Owner,27-Dec-2022
p h l u r 0,Archer,9-Jan-2022
qijg,Archer,5-Jan-2023
QueenJay96,Archer,15-Jun-2022
qwerty2431,Goblin,7-Jun-2024
Rainbow Halo,Diamond,1-Mar-2024
Ray Raymond,Battlemage,29-Dec-2021
Real Despair,Archer,4-Dec-2022
real sellout,Moderator,4-Nov-2021
Reklio,Archer,5-Feb-2022
Rest Tech,Archer,2-Feb-2022
RexxTheBeast,Battlemage,22-Apr-2022
Ripple,Dragonstone,10-Jan-2022
robkiller1,Battlemage,31-May-2021
Roth1990,Archer,1-Nov-2021
roxylee661,Archer,2-Jul-2021
RPG Slave,Battlemage,27-Jan-2024
RR0R,Battlemage,1-Jul-2021
Ruhbeartoee,Goblin,20-Aug-2024
RunicHero01,Battlemage,5-Nov-2021
Rushuk88,Battlemage,1-Nov-2021
Rvdhbk5,Archer,12-Apr-2023
ryan millard,Archer,2-Jul-2022
Ryhma Rauta,Goblin,7-Oct-2024
RY the iron,Archer,21-Oct-2022
Sadrumi,Battlemage,1-Nov-2021
Salvatore Ro,Gamer,16-Sep-2023
samambo No5,Archer,24-Feb-2024
Savage K-9,Battlemage,22-Dec-2021
Scabbyjoe,Archer,25-Apr-2022
ScMoAcLkL,Archer,6-Jul-2022
Scotty RWTs,Goblin,18-May-2024
ScrudHound,Battlemage,1-Dec-2021
SeksiSaukko,Archer,10-Nov-2022
SexBoat,Gamer,26-May-2022
ShadowIsLife,Battlemage,14-Jul-2022
Shae Verpus,Archer,4-Jul-2022
sir no trade,Archer,27-Jun-2023
Slazzeerr,Archer,11-Apr-2022
SmarmyMime,Archer,15-Jan-2024
SMlDGET,Dragonstone,4-Nov-2021
Soul Elf Fox,Infantry,13-Apr-2023
SpacedEK,Goblin,26-Jan-2025
SquidLov3,Archer,7-Jun-2022
Srnrox,Archer,14-Feb-2022
Stamstaa,Archer,22-Apr-2022
Sticky Runtz,Goblin,24-Nov-2024
StillNoobTho,Administrator,22-Dec-2024
Stratrs,Sniper,19-Nov-2022
Straynger10,Archer,5-Jan-2023
sugebaby,Artillery,27-May-2021
supergod200,Battlemage,1-Nov-2021
Sweattyballz,Elite,7-May-2023
Swift Muslim,Deputy Owner,26-May-2021
Sx 99 Range,Infantry,4-Apr-2022
Sx 99 Ranqe,Archer,15-Feb-2022
S H A Tt E R,Battlemage,1-Nov-2021
T04veesta,Battlemage,27-May-2021
T1Talon,Archer,19-Sep-2022
Taco Blood,Goblin,22-Jul-2024
TeamZiggy,Crusader,23-Feb-2022
TeenMom2004,Archer,7-Oct-2022
tehStickBoi,Archer,20-Jan-2022
TheDutchAnon,Battlemage,29-Dec-2021
theloudpack,Battlemage,6-Nov-2021
Thotosarous,Archer,23-Aug-2022
thyholymule,Crusader,11-Nov-2022
tonsof,Archer,22-Feb-2022
Torbreyn,Archer,27-Aug-2022
toseebee,Battlemage,28-Dec-2021
Tyler John20,Raider,11-Aug-2022
ucantseeme2,Archer,22-Oct-2022
ucok25,Archer,11-Apr-2022
uglytranny,Archer,28-May-2022
UIM Glxy,Archer,6-Mar-2024
um okay,Deputy Owner,4-Nov-2021
Unc1eIr0h,Battlemage,19-Nov-2021
V A N DAL,Battlemage,14-Sep-2022
Vandal XZ,Goblin,14-Sep-2024
vasa cm,Battlemage,31-Dec-2021
Velltix,Battlemage,25-Nov-2021
vicinvip,Goblin,29-Aug-2024
VictorCharly,Battlemage,27-Nov-2021
Wardle101,Battlemage,4-Nov-2021
wasahardcor,Goblin,22-Jan-2025
watnkutspel,Archer,10-Apr-2022
Welsh Wench,Goblin,15-Nov-2024
weremadogat,Raider,11-Mar-2023
why no pizza,Goblin,15-Nov-2024
WindGuideYou,Raider,25-Apr-2023
wombledore,Battlemage,5-Nov-2021
xFleecy,Goblin,26-Dec-2024
xLemon77x,Battlemage,23-Feb-2022
xrgo,Archer,28-Jan-2024
xTitanFodder,Archer,15-Jan-2022
Yoinkology,Archer,23-Feb-2022
YourGAYmate7,Archer,19-Aug-2022
yup ok mhm,Archer,19-Apr-2022
Zackgojira18,Battlemage,25-Nov-2021
ZammyExt,Moderator,25-Apr-2022
ZBech,Battlemage,31-Dec-2021
zewted,Battlemage,4-Jun-2022
Zlaughter-9,Battlemage,29-Jul-2022`;

document.addEventListener('DOMContentLoaded', function() {
    // Handle navigation
    const navLinks = document.querySelectorAll('.nav-links a');
    
    // Function to activate the correct section and nav link
    function activateSection(sectionId) {
        // Remove active class from all sections and nav links
        document.querySelectorAll('.section, .active-section').forEach(section => {
            section.classList.remove('active-section');
        });
        navLinks.forEach(link => {
            link.classList.remove('active');
        });
        
        // Add active class to target section and nav link
        const targetSection = document.getElementById(sectionId);
        const targetLink = document.querySelector(`a[href="#${sectionId}"]`);
        
        if (targetSection) {
            targetSection.classList.add('active-section');
        }
        if (targetLink) {
            targetLink.classList.add('active');
        }
    }
    
    // Handle click events on nav links
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            activateSection(targetId);
            
            // Update URL hash without scrolling
            history.pushState(null, null, `#${targetId}`);
        });
    });
    
    // Handle initial page load and browser back/forward
    function handleHashChange() {
        const hash = window.location.hash.substring(1) || 'home';
        activateSection(hash);
    }
    
    window.addEventListener('hashchange', handleHashChange);
    handleHashChange(); // Handle initial page load
    
    // Load members when the members section becomes active
    const membersLink = document.querySelector('a[href="#members"]');
    membersLink.addEventListener('click', loadMembers);
    
    // Load members if we start on the members page
    if (window.location.hash === '#members') {
        loadMembers();
    }
    
    const hiscoresLink = document.querySelector('a[href="#hiscores"]');
    hiscoresLink.addEventListener('click', loadHiscores);
    
    if (window.location.hash === '#hiscores') {
        loadHiscores();
    }
    
    // Handle tab switching
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => {
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            button.classList.add('active');
            
            if (button.dataset.view === 'total') {
                document.getElementById('totalHiscores').classList.remove('hidden');
                document.getElementById('skillsDetails').classList.add('hidden');
            } else {
                document.getElementById('totalHiscores').classList.add('hidden');
                document.getElementById('skillsDetails').classList.remove('hidden');
            }
        });
    });

    // Add this to your existing DOMContentLoaded event listener
    document.querySelectorAll('.skill-link').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            
            // Update active state
            document.querySelectorAll('.skill-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            
            // Get the selected skill
            const skill = link.dataset.skill;
            
            // Sort players by the selected skill
            const sortedPlayers = [...allPlayerData].sort((a, b) => {
                const skillA = a.skills[skill] || { level: 1, xp: 0 };
                const skillB = b.skills[skill] || { level: 1, xp: 0 };
                return skillB.xp - skillA.xp;
            });
            
            // Reset to first page and update display
            currentPage = 1;
            updateHiscoresDisplay(sortedPlayers);
        });
    });

    // Load announcements on home page
    loadHomeAnnouncements();
    
    // Add event listener for navigation to reload announcements
    document.querySelector('a[href="#home"]').addEventListener('click', loadHomeAnnouncements);

    // Add this to your DOMContentLoaded event listener
    document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            // Update active tab
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // Show corresponding form
            const formId = tab.dataset.tab + 'Form';
            document.querySelectorAll('.auth-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(formId).classList.remove('hidden');
        });
    });

    // Add click handler for account portal
    document.querySelector('.account-portal img').addEventListener('click', () => {
        window.location.href = '#account';
    });
});

async function searchPlayer() {
    const username = document.getElementById('playerSearch').value.toLowerCase();
    const statsDiv = document.getElementById('playerStats');
    
    // Get list of clan members
    const clanMembers = membersText.split('\n')
        .map(line => {
            const [name, rank] = line.split(',').map(item => item.trim());
            return { name, rank };
        });
    
    // Check if searched player is a clan member
    const memberInfo = clanMembers.find(member => member.name.toLowerCase() === username);
    
    if (!memberInfo) {
        statsDiv.innerHTML = '<p class="error">Player not found in clan roster.</p>';
        return;
    }
    
    try {
        const response = await fetch(`https://api.wiseoldman.net/v2/players/${username}`);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        
        if (data) {
            statsDiv.innerHTML = `
                <div class="player-header">
                    <h3>${data.displayName}</h3>
                    <span class="player-rank">${memberInfo.rank}</span>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span>Combat Level:</span>
                        <span>${data.combatLevel}</span>
                    </div>
                    <div class="stat-item">
                        <span>Total Level:</span>
                        <span>${data.skills.overall.level}</span>
                    </div>
                    <div class="stat-item">
                        <span>Total Experience:</span>
                        <span>${data.skills.overall.experience.toLocaleString()}</span>
                    </div>
                </div>
                <div class="skills-overview">
                    ${Object.entries(data.skills)
                        .filter(([skillName]) => skillName !== 'overall')
                        .map(([skillName, skillData]) => `
                            <div class="skill-item">
                                <img src="images/skill_icon_${skillName}1.gif" alt="${skillName}" class="skill-icon">
                                <div class="skill-info">
                                    <div class="skill-level">Level ${skillData.level}</div>
                                    <div class="skill-xp">${skillData.experience.toLocaleString()} XP</div>
                                </div>
                            </div>
                        `).join('')}
                </div>
            `;
        }
    } catch (error) {
        statsDiv.innerHTML = '<p class="error">Error fetching player data. Please try again.</p>';
        console.error('Error fetching player data:', error);
    }
}

// Add this function to show all clan members sorted by rank
async function showAllMembers() {
    const statsDiv = document.getElementById('playerStats');
    statsDiv.innerHTML = '<div class="loading">Loading clan members...</div>';
    
    // Define rank order
    const rankOrder = [
        'Owner',
        'Deputy Owner',
        'Administrator',
        'Moderator',
        'General',
        'Captain',
        'Lieutenant',
        'Sergeant',
        'Corporal',
        'Recruit'
    ];
    
    // Get and sort clan members
    const clanMembers = membersText.split('\n')
        .map(line => {
            const [name, rank] = line.split(',').map(item => item.trim());
            return { name, rank };
        })
        .sort((a, b) => {
            const rankA = rankOrder.indexOf(a.rank);
            const rankB = rankOrder.indexOf(b.rank);
            return rankA - rankB;
        });
    
    // Create HTML for members list
    const membersHTML = `
        <div class="members-list">
            ${clanMembers.map(member => `
                <div class="member-row" onclick="searchPlayer('${member.name}')">
                    <img src="images/Clan_icon_-_${member.rank.replace(' ', '_')}.png" alt="${member.rank}" class="rank-icon">
                    <span class="member-name">${member.name}</span>
                    <span class="member-rank">${member.rank}</span>
                </div>
            `).join('')}
        </div>
    `;
    
    statsDiv.innerHTML = membersHTML;
}

async function loadMembers() {
    try {
        console.log('Loading members...');
        
        // Store members list directly in a variable
        const membersList = document.getElementById('membersList');
        if (!membersList) {
            throw new Error('membersList element not found!');
        }
        
        // Clear existing content
        membersList.innerHTML = '';
        
        // Process each line
        let count = 0;
        membersText.split('\n').forEach(line => {
            if (line.trim()) {
                const [username, rank, joinDate] = line.split(',').map(item => item.trim());
                console.log('Processing member:', username, rank, joinDate);
                
                const memberCard = document.createElement('div');
                memberCard.className = 'member-card';
                
                // Create rank icon
                const rankIcon = document.createElement('img');
                let iconRank = rank;
                if (rank === 'Deputy Owner') {
                    iconRank = 'General';
                }
                rankIcon.src = `images/Clan_icon_-_${iconRank}.png`;
                rankIcon.alt = rank;
                rankIcon.className = 'rank-icon';
                
                // Create username element
                const nameSpan = document.createElement('span');
                nameSpan.className = 'member-name';
                nameSpan.textContent = username;
                
                // Create join date element
                const dateSpan = document.createElement('span');
                dateSpan.className = 'join-date';
                dateSpan.textContent = joinDate;
                
                // Add elements to card
                memberCard.appendChild(rankIcon);
                memberCard.appendChild(nameSpan);
                memberCard.appendChild(dateSpan);
                membersList.appendChild(memberCard);
                count++;
            }
        });
        console.log(`Processed ${count} members`);
    } catch (error) {
        console.error('Error loading members:', error);
        const membersList = document.getElementById('membersList');
        if (membersList) {
            membersList.innerHTML = `<div class="error">Error loading members: ${error.message}</div>`;
        }
    }
}

let currentPage = 1;
const itemsPerPage = 25;
let allPlayerData = [];

async function loadHiscores() {
    const hiscoresData = document.getElementById('hiscoresData');
    hiscoresData.innerHTML = `
        <div class="coming-soon">
            <h3>Hiscores Under Development</h3>
            <p>This feature is currently being worked on and will be available soon!</p>
        </div>
    `;
}

function updateHiscoresDisplay() {
    const hiscoresData = document.getElementById('hiscoresData');
    const sortedPlayers = [...allPlayerData].sort((a, b) => b.xp - a.xp);
    
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = Math.min(startIndex + itemsPerPage, sortedPlayers.length);
    const pageCount = Math.ceil(sortedPlayers.length / itemsPerPage);

    // Update pagination controls
    document.getElementById('prevPage').disabled = currentPage === 1;
    document.getElementById('nextPage').disabled = currentPage >= pageCount;
    document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${pageCount}`;

    // Display the current page
    hiscoresData.innerHTML = sortedPlayers
        .slice(startIndex, endIndex)
        .map((player, index) => `
            <div class="hiscores-row">
                <span class="rank">${startIndex + index + 1}</span>
                <span class="name">
                    <img src="images/Clan_icon_-_${player.rank.replace(' ', '_')}.png" alt="${player.rank}" class="rank-icon">
                    ${player.username}
                </span>
                <span class="level">${player.level}</span>
                <span class="xp">${player.xp.toLocaleString()}</span>
            </div>
        `).join('');
}

// Add event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Load hiscores when clicking the hiscores nav link
    const hiscoresLink = document.querySelector('a[href="#hiscores"]');
    hiscoresLink.addEventListener('click', loadHiscores);

    // Load hiscores if we start on the hiscores page
    if (window.location.hash === '#hiscores') {
        loadHiscores();
    }

    // Pagination handlers
    document.getElementById('prevPage').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            updateHiscoresDisplay();
        }
    });

    document.getElementById('nextPage').addEventListener('click', () => {
        currentPage++;
        updateHiscoresDisplay();
    });
});

// Update showSkillDetails to handle the stringified player data
function showSkillDetails(player) {
    const skillsDetails = document.getElementById('skillsDetails');
    skillsDetails.classList.remove('hidden');
    document.getElementById('totalHiscores').classList.add('hidden');
    
    // Map the WOM API skill names to your icon filenames
    const skillIconMap = {
        'overall': 'Skills_icon',
        'attack': 'skill_icon_attack1',
        'defence': 'skill_icon_defence1',
        'strength': 'skill_icon_strength1',
        'hitpoints': 'skill_icon_hitpoints1',
        'ranged': 'skill_icon_ranged1',
        'prayer': 'skill_icon_prayer1',
        'magic': 'skill_icon_magic1',
        'cooking': 'skill_icon_cooking1',
        'woodcutting': 'skill_icon_woodcutting1',
        'fletching': 'skill_icon_fletching1',
        'fishing': 'skill_icon_fishing1',
        'firemaking': 'skill_icon_firemaking1',
        'crafting': 'skill_icon_crafting1',
        'smithing': 'skill_icon_smithing1',
        'mining': 'skill_icon_mining1',
        'herblore': 'skill_icon_herblore1',
        'agility': 'skill_icon_agility1',
        'thieving': 'skill_icon_thieving1',
        'slayer': 'skill_icon_slayer1',
        'farming': 'skill_icon_farming1',
        'runecraft': 'skill_icon_runecraft1',
        'hunter': 'skill_icon_hunter1',
        'construction': 'skill_icon_construction1'
    };

    const skillsHTML = Object.entries(player.skills)
        .filter(([skillName]) => skillName !== 'overall')
        .map(([skillName, data]) => `
            <div class="skill-item">
                <img src="images/${skillIconMap[skillName]}.gif" alt="${skillName}" class="skill-icon">
                <div class="skill-info">
                    <div class="skill-name">${skillName.charAt(0).toUpperCase() + skillName.slice(1)}</div>
                    <div class="skill-level">Level ${data.level}</div>
                    <div class="skill-xp">${data.experience.toLocaleString()} XP</div>
                </div>
            </div>
        `).join('');

    skillsDetails.innerHTML = `
        <h3>${player.username}'s Skills</h3>
        <div class="skills-grid">
            ${skillsHTML}
        </div>
        <button class="tab-button" onclick="hideSkillDetails()">Back to Hiscores</button>
    `;
}

// Add a function to hide skill details
function hideSkillDetails() {
    document.getElementById('skillsDetails').classList.add('hidden');
    document.getElementById('totalHiscores').classList.remove('hidden');
}

function openManagerPortal() {
    // Create and show the authentication modal
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    modal.id = 'managerAuthModal';
    
    modal.innerHTML = `
        <div class="auth-modal">
            <div class="auth-modal-header">
                <h3>Manager Portal Access</h3>
            </div>
            <form id="managerAuthForm">
                <div class="form-group">
                    <label for="accessCode">Access Code</label>
                    <input type="password" 
                           id="accessCode" 
                           class="form-input" 
                           placeholder="Enter access code"
                           required>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-button" onclick="closeManagerModal()">Cancel</button>
                    <button type="submit" class="submit-button">Login</button>
                </div>
            </form>
        </div>
    `;

    document.body.appendChild(modal);
    
    // Show modal with animation
    requestAnimationFrame(() => {
        modal.style.display = 'flex';
        modal.style.opacity = '0';
        requestAnimationFrame(() => {
            modal.style.opacity = '1';
        });
    });

    // Focus the input
    setTimeout(() => {
        document.getElementById('accessCode').focus();
    }, 100);

    // Close modal when clicking outside
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeManagerModal();
        }
    });

    // Handle form submission
    document.getElementById('managerAuthForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const accessCode = document.getElementById('accessCode').value;
        
        if (accessCode === 'bgclan') {
            localStorage.setItem('managerToken', 'authenticated');
            closeManagerModal();
            window.location.href = 'manager.html';
        } else {
            showAuthError('Invalid access code');
        }
    });
}

function closeManagerModal() {
    const modal = document.getElementById('managerAuthModal');
    if (modal) {
        modal.style.opacity = '0';
        setTimeout(() => {
            modal.remove();
        }, 300);
    }
}

function showAuthError(message) {
    const existingError = document.querySelector('.auth-error');
    if (existingError) {
        existingError.remove();
    }

    const errorDiv = document.createElement('div');
    errorDiv.className = 'auth-error';
    errorDiv.textContent = message;
    
    const form = document.getElementById('managerAuthForm');
    form.insertBefore(errorDiv, form.firstChild);

    document.getElementById('accessCode').value = '';
    document.getElementById('accessCode').focus();
}

// Add these styles to your CSS
const newStyles = `
    .auth-error {
        color: #ff4444;
        background-color: rgba(255, 68, 68, 0.1);
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 15px;
        text-align: center;
    }

    .form-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .cancel-button {
        flex: 1;
        padding: 12px;
        background-color: var(--primary-color);
        color: var(--text-color);
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }

    .cancel-button:hover {
        background-color: var(--border-color);
    }

    .modal-overlay {
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .auth-modal {
        transform: translateY(20px);
        transition: transform 0.3s ease;
    }

    .modal-overlay[style*="display: flex"] .auth-modal {
        transform: translateY(0);
    }
`;

// Add the styles to the page
const styleSheet = document.createElement('style');
styleSheet.textContent = newStyles;
document.head.appendChild(styleSheet);